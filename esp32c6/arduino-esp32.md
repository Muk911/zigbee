# Разработка Zigbee устройств на ESP32-C6/H2 в среде Arduino IDE

## Установка Arduino IDE и расширения для ESP32-C6/H2 ###
1. Скачайте и установите актуальную версию Arduino IDE. На момент написания этого текста последней версией была версия 2.3.4.
2. В диалоге настроек **Preferences** в разделе **Additional boards manager URLs** укажите ссылку для Arduino-ESP32 (ссылка для DEV-версии: https://espressif.github.io/arduino-esp32/package_esp32_dev_index.json).
3. Вызовите менеджер плат Boards Manager. В поиске наберите "esp32" и найдите библиотеку плат "esp32 by Expressif Systems". На момент написания этого текста последней версией была версия 3.1.2. Установите библиотеку плат.
4. В меню Tools выберите подходящий модуль, например Board > esp32 > **ESP32C6 Dev Module**.
5. В меню Tools выберите Partition Scheme = "Zigbee 4MB with spiffs".
6. В меню Tools выберите Zigbee Mode = "Zigbee ED (end device)" или "Zigbee ZCZR (coordinatior/router)" в зависимости от того, хотите Вы реализовать End Device или Router.
7. Для возможности использования отладочной информации (например, функций ESP_LOGI() или log_i()) выберите в меню Tools значение Core Debug Level в зависимости от желаемого уровня отладки, например "Info".

## Подключение модуля ###
1. Подключите модуль ESP32-C6/H2 к ПК через UART. На отладочных модулях ESP32-C6-DevKit имеется встроенный преобразователь USB-UART, выведенный на USB Type-C разъем с надписью "UART". Для подключения "голых" модулей необходим внешний преобразователь USB-UART.
2. Выберите порт модуля в Arduino IDE. При необходимости перезапустите Arduino IDE для обновления списка доступных портов.

## Загрузка прошивки ###
1. Загрузите в IDE текстовый скетч Blink и выполните загрузку прошивки (Upload) в модуль. Отладочные модули ESP32-C6-DevKit обеспечивают автоматическое притягивание к "0" вывода GPIO9 для перевода чипа в режим загрузки прошивки. Перемычка отключения периферии должна быть установлена. Если у Вас "голый" модуль или по каким-то причинам автоматический перевод чипа в режим загрузки прошивки не выполняется, необходимо притянуть к "0" вывод GPIO9 (нажать и удерживать кнопку BOOT при ее наличии), сбросить чип кратковременным притягиванием вывода EN к "0" (кратковременно нажать кнопку RESET при ее наличии). После этого модуль может быть отсоединен от "0".
2. После успешной загрузки скетча Blink на модуле будет мигать встроенный светодиод.
   
## Разработка Zigbee-устройств ###
1. Далее можно перейти к реализации первого устройства Zigbee. Для успешной разработки необходимо изучить принципы использования FreeRTOS и основы стандарта Zigbee Cluster Library.
2. В репозитории приведен пример скетча zed_sample.ino для конечного устройства Zigbee, реализующего одну конечную точку (endpoint) и два стандартных кластера - OnOff и Temperature Measurement. Реализация кластера OnOff имитирует работу умного реле, а реализация кластера Temperature Measurement имитирует работу сенсора температуры. При переключении состояния "реле" происходит включение/выключение встроенного светодиода ESP32-C6. Изменение  температуры имитируется с помощью генератора случайных чисел.
